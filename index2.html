<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATM Simulator ‚Äî Final Level</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#0f172a,#020617);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      transition: 0.3s ease;
    }

    body.light {
      background: linear-gradient(135deg,#e5e7eb,#9ca3af);
      color: black;
    }

    .container {
      backdrop-filter: blur(14px);
      background: rgba(17,24,39,0.75);
      padding: 24px;
      border-radius: 20px;
      width: 390px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
      text-align: center;
    }

    input, button {
      width: 100%;
      padding: 11px;
      margin: 8px 0;
      border-radius: 10px;
      border: none;
      font-size: 14px;
    }

    input { background:#1f2937; color:white; }

    button {
      background:#22c55e;
      color:black;
      font-weight:bold;
      cursor:pointer;
      transition:0.2s ease;
    }

    button:hover { transform:translateY(-1px); }

    .menu button { background:#3b82f6; color:white; }
    .hidden { display:none; }

    .history {
      background:#0b1220;
      border-radius:10px;
      padding:10px;
      margin-top:12px;
      max-height:140px;
      overflow-y:auto;
      text-align:left;
      font-size:13px;
    }

    .toggle {
      cursor:pointer;
      font-size:12px;
      background:#111827;
      padding:4px 8px;
      border-radius:6px;
      margin-bottom:6px;
      display:inline-block;
    }

    @media (max-width:420px){ .container{width:92%;} }
  </style>
</head>
<body>
  <div class="container">
    <div class="toggle" onclick="toggleTheme()">üåô Toggle Theme</div>
    <h1>üèß ATM Simulator</h1>

    <!-- REGISTER -->
    <div id="register">
      <input id="username" placeholder="Create username" />
      <input type="password" id="setPin" placeholder="Set PIN" />
      <input type="number" id="initialBalance" placeholder="Initial balance" />
      <button onclick="registerUser()">Register</button>
    </div>

    <!-- LOGIN -->
    <div id="login" class="hidden">
      <input id="loginUser" placeholder="Username" />
      <input type="password" id="enterPin" placeholder="PIN" />
      <button onclick="loginUserFunc()">Login</button>
      <div id="loginMsg"></div>
    </div>

    <!-- MENU -->
    <div id="menu" class="hidden menu">
      <button onclick="checkBalance()">Check Balance</button>
      <button onclick="depositMoney()">Deposit</button>
      <button onclick="withdrawMoney()">Withdraw</button>
      <button onclick="clearHistory()">Clear History</button>
      <button onclick="logout()">Logout</button>
      <div id="menuMsg"></div>
      <div class="history" id="historyBox"></div>
    </div>
  </div>

  <script>
    // ===== GLOBAL STATE =====
    let currentUser = null;
    let users = JSON.parse(localStorage.getItem("atm_users") || "{}");

    // ===== THEME =====
    function toggleTheme(){ document.body.classList.toggle("light"); }

    // ===== SAVE USERS =====
    function saveUsers(){ localStorage.setItem("atm_users", JSON.stringify(users)); }

    // ===== REGISTER =====
    function registerUser(){
      const u = username.value.trim();
      const p = setPin.value.trim();
      const b = Number(initialBalance.value);

      if(!u||!p||isNaN(b)||b<0){ alert("Enter valid details"); return; }
      if(users[u]){ alert("User already exists"); return; }

      users[u]={ pin:p, balance:b, history:[] };
      saveUsers();
      alert("Registered successfully");

      register.classList.add("hidden");
      login.classList.remove("hidden");
    }

    // ===== LOGIN =====
    function loginUserFunc(){
      const u = loginUser.value.trim();
      const p = enterPin.value.trim();
      const msg = document.getElementById("loginMsg");

      if(!users[u]){ msg.textContent="User not found"; return; }
      if(users[u].pin!==p){ msg.textContent="Wrong PIN"; return; }

      currentUser=u;
      login.classList.add("hidden");
      menu.classList.remove("hidden");
      renderHistory();
    }

    // ===== HISTORY =====
    function addHistory(text){
      const t=new Date().toLocaleTimeString();
      users[currentUser].history.unshift(`[${t}] ${text}`);
      if(users[currentUser].history.length>25) users[currentUser].history.pop();
      saveUsers();
      renderHistory();
    }

    function renderHistory(){
      const h=users[currentUser].history;
      historyBox.innerHTML=h.length? h.map(x=>`<div>${x}</div>`).join("") : "<div>No transactions</div>";
    }

    function clearHistory(){ users[currentUser].history=[]; saveUsers(); renderHistory(); }

    // ===== ATM OPS =====
    function checkBalance(){
      menuMsg.textContent=`Balance: ‚Çπ${users[currentUser].balance}`;
      addHistory(`Checked balance`);
    }

    function depositMoney(){
      const a=Number(prompt("Deposit amount:"));
      if(isNaN(a)||a<=0) return alert("Invalid amount");
      users[currentUser].balance+=a; saveUsers();
      menuMsg.textContent=`Deposited ‚Çπ${a}`;
      addHistory(`Deposited ‚Çπ${a}`);
    }

    function withdrawMoney(){
      const a=Number(prompt("Withdraw amount:"));
      if(isNaN(a)||a<=0) return alert("Invalid amount");
      if(a>users[currentUser].balance) return alert("Insufficient funds");
      users[currentUser].balance-=a; saveUsers();
      menuMsg.textContent=`Withdrew ‚Çπ${a}`;
      addHistory(`Withdrew ‚Çπ${a}`);
    }

    function logout(){
      currentUser=null;
      menu.classList.add("hidden");
      login.classList.remove("hidden");
    }
  </script>
</body>
</html>
